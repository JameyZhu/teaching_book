# Linux 上机指南 {#linux-task}

<!--

old: https://github.com/lulab/teaching_book/blob/a7b07672e0701876b6c953e8ae703bb5a3e91dff/part-i.-basic-tools/1.2.linux-tasks.md
胡茜: https://github.com/lulab/teaching_book/blob/bff6658cf4a998a5148be3457dc256aaa1cafddf/part-i.-basic-tools/1.2.linux-tasks.md

-->

## 0) Warm up

首先，让我们来看一些很酷的例子（仅作演示，不要运行）

1. 从 `.gtf` 文件中分离提取基因名字及其长度

   ```bash
   cat 1.gtf | awk '$3 == "gene"{split($10,x,";");name = x[1];gsub("\"", "", name);print name,$5-$4+1}' | head -n 6
   ```
   
   ```
   YDL248W 1152
   YDL247W-A 75
   YDL247W 1830
   YDL246C 1074
   YDL245C 1704
   YDL244W 1023
   ```​

1. 计算 1 号染色体 gene 的平均长度
   
   ```bash
   cat 1.gtf | awk 'BEGIN  {s = 0;line = 0 } ;$3 =="CDS" && $1 =="I" { s += ($5 - $4);line += 1}; END {print "mean=" s/line}' 
   ```
   
   ```
   mean=1238.52
   ```


很厉害吧！想做到这样的事情就要先学好 Linux 基本功哦。



## 1) Pipeline

![](https://blobscdn.gitbook.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-LKVqnYQRAUMNxYIv37L%2F-LKzy_S2L64ALvymCkQn%2F-LKzzkp2NcEfOjdiUu4m%2FLinux%20pipeline.png?alt=media&token=f1827914-7c70-4a14-a860-c92fc7f7285a)

## 2) Data Structure

GTF全称为gene transfer format，主要是用来对基因进行注释。

GTF文件由9列数据组成，以tab键分割，每一列的对应信息如下：

![](https://blobscdn.gitbook.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-LKVqnYQRAUMNxYIv37L%2F-LKWHaFARnIn3_kZa4H7%2F-LKWOsJIwbvlcwphxylu%2F%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-08-22%20%E4%B8%8B%E5%8D%887.31.10.png?alt=media&token=ddfa739c-fbb1-434e-9eca-999746b9711b)

## 3) Running Scripts

在开始实战演练前，建议同学们先学习一下 [Linux 基本命令](1.linux-command.md)，一定要熟练掌握哦。

首先进入到容器（在自己电脑的 Terminal 中运行，详情请参见 [这里](https://lulab.gitbooks.io/teaching/getting-started.html#use-container)）：    

```bash
docker exec -it bioinfo_tsinghua bash
```


以下步骤均在 `/home/test/linux/` 下进行:  

```bash
cd /home/test/linux/
```

然后解压，得到输入文件

```bash
gunzip 1.gtf.gz
```

先来一些基本的操作

```bash
head 1.gtf    # 显示1.gtf文件前10行
tail -n 6 1.gtf    # 显示1.gtf文件后6行
​
ls -lh 1.gtf  # 显示1.gtf文件的大小
wc -l 1.gtf   # 统计1.gtf文件行数
```

让我们加大难度

```bash
tail -n 10 1.gtf | cut -f 1,3,4,5  #选取最后 10 行的第1,3，4,5列，即 chr,feature,start,end。

grep -v '^#' 1.gtf | head   # 除去最前面的几行注释
grep $'^X\t' 1.gtf | wc -l  # 查看 X 染色体上的 feature 的数目
```

接下来是最难的部分，管道连起来（虽然命令看起来很复杂，但是从左往右一个一个读就一点也不难学哦）

```bash
grep -v '^#' 1.gtf | cut -f 3 | sort | uniq -c # 统计各类 feature 的数目

grep $'^X\t' 1.gtf | grep $'gene\t' | sort -k 4 -n | head #  X 染色体上的前 10 个基因（按照起始位置的基因组坐标）
```
​
至此短暂的训练就结束了。由于课程容量的限制，这里没有介绍 `awk` 命令，所以到最后也没实现开头提到的那些例子。

但是，​更重要的是，Linux 的基本操作也是本书中（几乎）全部生物信息分析流程的必需技能。再强调一遍，大家一定要反复练习，熟练掌握哦。

## 4) Tips/Utilities

本章参考了以下几篇生信文章：

- <https://www.jianshu.com/p/48b5a0972301>
- <https://blog.csdn.net/sinat_38163598/article/details/72851239>
- <https://zhuanlan.zhihu.com/p/36065699>
- <https://gist.github.com/sp00nman/10372555>
- <https://www.jianshu.com/p/7af624409dcd>



## 5) Homework and more


1. 查找、理解并注释上述每一个语句和参数的意义。
1. 列出 XI 号染色体上的后 10 个 CDS （按照终止位置的基因组坐标）
1. 统计 IV 号统计各类 feature 的数目，并按升序排列

